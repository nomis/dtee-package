From a7611ff355afa0e07e66609bf2c9198f37bb0799 Mon Sep 17 00:00:00 2001
From: Simon Arlott <sa.me.uk>
Date: Sat, 11 Mar 2023 19:37:25 +0000
Subject: [PATCH] meson: Use install_symlink() for "cronty" alias

---
 docs/dependencies.rst |  2 +-
 docs/meson.build      | 11 ++++-------
 meson.build           | 11 ++---------
 tests/util/common.sh  |  2 +-
 4 files changed, 8 insertions(+), 18 deletions(-)

Index: dtee-1.1.0/docs/dependencies.rst
===================================================================
--- dtee-1.1.0.orig/docs/dependencies.rst
+++ dtee-1.1.0/docs/dependencies.rst
@@ -23,7 +23,7 @@ Compile
 
   * `GNU gettext <https://www.gnu.org/software/gettext/>`_
   * `GNU Make <https://www.gnu.org/software/make/>`_ 3.80+ (optional)
-  * `Meson <https://mesonbuild.com/>`_ 0.53+
+  * `Meson <https://mesonbuild.com/>`_ 0.61+
 
     ..
        Upgrade when Meson can install symlinks.
Index: dtee-1.1.0/docs/meson.build
===================================================================
--- dtee-1.1.0.orig/docs/meson.build
+++ dtee-1.1.0/docs/meson.build
@@ -21,6 +21,8 @@ if sphinx_build.found()
 		'packages/ubuntu.rst',
 	]
 
+	man_dir = join_paths(get_option('mandir'), 'man1')
+
 	dtee_man = custom_target('dtee.1',
 		input: source_docs,
 		output: 'dtee.1',
@@ -35,12 +37,7 @@ if sphinx_build.found()
 			'@OUTDIR@',
 		],
 		install: true,
-		install_dir: join_paths(get_option('mandir'), 'man1'))
+		install_dir: man_dir)
 
-	custom_target('cronty.1',
-		input: dtee_man,
-		output: 'cronty.1',
-		command: [ln, '-s', '-f', '@PLAINNAME@', '@OUTPUT@'],
-		install: true,
-		install_dir: join_paths(get_option('mandir'), 'man1'))
+	install_symlink('cronty.1', pointing_to: 'dtee.1', install_dir: man_dir)
 endif
Index: dtee-1.1.0/meson.build
===================================================================
--- dtee-1.1.0.orig/meson.build
+++ dtee-1.1.0/meson.build
@@ -8,7 +8,7 @@ project('dtee',
 	],
 	version: '1.1.0',
 	license: 'GPL3+',
-	meson_version: '>=0.53.0',
+	meson_version: '>=0.61.0',
 )
 
 c = meson.get_compiler('c')
@@ -76,14 +76,7 @@ dtee = executable('dtee',
 	install_rpath: rpath,
 	install: true)
 
-ln = find_program('ln')
-
-custom_target('cronty',
-	input: dtee,
-	output: 'cronty',
-	command: [ln, '-s', '-f', '@INPUT@', '@OUTPUT@'],
-	install: true,
-	install_dir: get_option('bindir'))
+install_symlink('cronty', pointing_to: 'dtee', install_dir: get_option('bindir'))
 
 subdir('docs')
 subdir('tests')
Index: dtee-1.1.0/tests/util/common.sh
===================================================================
--- dtee-1.1.0.orig/tests/util/common.sh
+++ dtee-1.1.0/tests/util/common.sh
@@ -16,7 +16,7 @@ while [ "$(basename -- "$dir")" != "test
 done
 
 ln -s ../dtee tests/dtee
-ln -s ../cronty tests/cronty
+ln -s dtee tests/cronty
 BASETESTDIR="dtee@test"
 TESTDIR="$BASETESTDIR"
 if [ "$GROUP" != "" ]; then
